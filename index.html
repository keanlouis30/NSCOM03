<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat Intelligence IOC Analyzer</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>NSCOM03</h1>
            </div>
            <nav class="nav">
                <span class="status-indicator" id="statusIndicator">
                    <i class="fas fa-circle"></i>
                    <span>Ready</span>
                </span>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- API Scores Section -->
            <section class="results-section" id="apiScoresSection">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> API Scores</h2>
                    <p>Scores derived from API_WEIGHTS.md (0‚Äì100). Click a bar to see the reasoning.</p>
                </div>
                <div id="apiScoresBars" class="api-bars">
                    <!-- Bars will be rendered here -->
                </div>
            </section>
            
            <script>
            // Standalone API Scores - Runs immediately
            (function() {
                const apiData = [
                    {
                        name: 'VirusTotal',
                        score: 95,
                        color: '#00ffff',
                        networkConnectivity: '38/40',
                        domains: '35/35',
                        trafficIntel: '22/25',
                        strengths: [
                            'Most comprehensive relational data in threat intelligence',
                            'Network behavior analysis for malware samples',
                            'Real-time DNS resolution history and subdomain discovery',
                            'Rich file-to-network relationship mapping',
                            'Multiple API key rotation support (3 keys configured)'
                        ],
                        keyCount: '3 keys (excellent rate limit management)'
                    },
                    {
                        name: 'IPinfo.io',
                        score: 88,
                        color: '#00cc99',
                        networkConnectivity: '37/40',
                        domains: '15/35',
                        trafficIntel: '11/25',
                        strengths: [
                            'Most accurate IP geolocation data available',
                            'Detailed ISP, carrier, and network infrastructure information',
                            'ASN details with network ownership and descriptions',
                            'High API limit (50,000 requests/month free tier)'
                        ],
                        specialization: 'Premier service for IP geolocation and network infrastructure intelligence'
                    },
                    {
                        name: 'SecurityTrails',
                        score: 85,
                        color: '#00aa88',
                        networkConnectivity: '30/40',
                        domains: '32/35',
                        trafficIntel: '8/25',
                        strengths: [
                            'Extensive historical DNS data and timeline analysis',
                            'Comprehensive subdomain enumeration capabilities',
                            'DNS infrastructure and nameserver intelligence',
                            'Domain-to-IP relationship tracking over time'
                        ],
                        limitations: 'Limited threat intelligence integration, Low monthly quota (50 queries/month free tier)',
                        specialization: 'Premier service for DNS intelligence and historical analysis'
                    },
                    {
                        name: 'WhoisXML API',
                        score: 82,
                        color: '#008877',
                        networkConnectivity: '25/40',
                        domains: '30/35',
                        trafficIntel: '5/25',
                        strengths: [
                            'Authoritative WHOIS data across all TLDs',
                            'Domain registration history and registrar intelligence',
                            'Administrative and technical contact information',
                            'Domain lifecycle and status tracking'
                        ],
                        specialization: 'Premier service for domain registration intelligence'
                    },
                    {
                        name: 'URLScan.io',
                        score: 78,
                        color: '#006666',
                        networkConnectivity: '25/40',
                        domains: '20/35',
                        trafficIntel: '18/25',
                        strengths: [
                            'Comprehensive URL and website behavior analysis',
                            'Web technology stack detection',
                            'Visual analysis with screenshots and DOM inspection',
                            'Network traffic analysis for web resources',
                            'Unlimited API usage with rate limits (free tier)'
                        ],
                        specialization: 'Premier service for URL and web content analysis'
                    },
                    {
                        name: 'IPQualityScore',
                        score: 76,
                        color: '#005555',
                        networkConnectivity: '30/40',
                        domains: '10/35',
                        trafficIntel: '18/25',
                        strengths: [
                            'Advanced fraud and risk scoring algorithms',
                            'Proxy, VPN, and TOR network detection',
                            'Bot and crawler identification',
                            'Recent abuse activity tracking',
                            'Good API limits (5,000 requests/month free tier)'
                        ],
                        specialization: 'Premier service for IP reputation and fraud detection'
                    },
                    {
                        name: 'AbuseIPDB',
                        score: 75,
                        color: '#004444',
                        networkConnectivity: '32/40',
                        domains: '0/35',
                        trafficIntel: '18/25',
                        strengths: [
                            'Specialized in IP abuse and reputation intelligence',
                            'Community-driven threat reporting with confidence metrics',
                            'ISP and geolocation context for IPs',
                            'Excellent for complementing technical analysis with abuse context'
                        ],
                        limitations: 'IP-only service (no domain, URL, or hash analysis), Limited network infrastructure details',
                        keyCount: '2 keys (good rate limit management)'
                    },
                    {
                        name: 'AlienVault OTX',
                        score: 70,
                        color: '#003333',
                        networkConnectivity: '28/40',
                        domains: '25/35',
                        trafficIntel: '17/25',
                        strengths: [
                            'Community threat intelligence platform',
                            'IOC relationship mapping across multiple indicator types',
                            'Threat context and campaign attribution data',
                            'Unlimited API usage (free tier)'
                        ],
                        limitations: 'Less comprehensive technical data compared to VirusTotal, Community-sourced data may have variable quality',
                        keyCount: '2 keys (good redundancy)'
                    }
                ];

                function renderBars() {
                    const container = document.getElementById('apiScoresBars');
                    if (!container) {
                        console.error('apiScoresBars container not found!');
                        return;
                    }

                    container.innerHTML = '';
                    
                    apiData.forEach(function(api) {
                        const barRow = document.createElement('div');
                        barRow.className = 'bar-row';
                        barRow.style.cssText = 'display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 8px 4px; border-radius: 8px; transition: background 0.2s ease; margin-bottom: 8px;';

                        const label = document.createElement('div');
                        label.className = 'bar-label';
                        label.textContent = api.name;
                        label.style.cssText = 'width: 180px; min-width: 160px; color: #fff; font-weight: 600;';

                        const bar = document.createElement('div');
                        bar.className = 'bar';
                        bar.style.cssText = 'flex: 1; height: 24px; background: linear-gradient(135deg, rgba(0,255,255,0.05), rgba(0,136,204,0.05)); border: 1px solid rgba(0,255,255,0.25); border-radius: 8px; overflow: hidden; position: relative;';

                        const barFill = document.createElement('div');
                        barFill.className = 'bar-fill';
                        barFill.style.cssText = 'height: 100%; width: ' + api.score + '%; background: linear-gradient(90deg, ' + api.color + ', ' + api.color + 'CC); transition: width 0.8s ease; box-shadow: 0 0 10px ' + api.color + '80;';
                        
                        const scoreDiv = document.createElement('div');
                        scoreDiv.className = 'bar-score';
                        scoreDiv.textContent = api.score;
                        scoreDiv.style.cssText = 'width: 48px; text-align: right; color: #ccc; font-weight: 600; font-size: 14px;';

                        bar.appendChild(barFill);
                        barRow.appendChild(label);
                        barRow.appendChild(bar);
                        barRow.appendChild(scoreDiv);
                        container.appendChild(barRow);

                        // Hover effect
                        barRow.addEventListener('mouseenter', function() {
                            barRow.style.background = 'rgba(0, 255, 255, 0.06)';
                        });
                        barRow.addEventListener('mouseleave', function() {
                            barRow.style.background = 'transparent';
                        });

                        // Click handler
                        barRow.addEventListener('click', function() {
                            showModal(api);
                        });
                    });
                    
                    console.log('API Scores rendered: ' + apiData.length + ' bars created!');
                }

                function showModal(api) {
                    const modal = document.getElementById('apiScoreModal');
                    const title = document.getElementById('apiScoreTitle');
                    const body = document.getElementById('apiScoreBody');

                    if (!modal || !title || !body) return;

                    title.textContent = api.name + ' - Score: ' + api.score + '/100';

                    var html = '<div style="background: linear-gradient(135deg, rgba(0,255,255,0.05), rgba(0,136,204,0.05)); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(0,255,255,0.1);">';
                    html += '<h4 style="color: #00ffff; margin-bottom: 0.5rem;">üìä Data Coverage</h4>';
                    html += '<div style="margin-left: 1rem; color: #e0e0e0;">';
                    html += '<p><strong>Network Connectivity (40% weight):</strong> ' + api.networkConnectivity + '</p>';
                    html += '<p><strong>Domains (35% weight):</strong> ' + api.domains + '</p>';
                    html += '<p><strong>Traffic Intelligence (25% weight):</strong> ' + api.trafficIntel + '</p>';
                    html += '</div></div>';

                    if (api.strengths) {
                        html += '<div style="background: linear-gradient(135deg, rgba(0,255,0,0.05), rgba(0,200,0,0.05)); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(0,255,0,0.1);">';
                        html += '<h4 style="color: #00ff00; margin-bottom: 0.5rem;">‚úÖ Strengths</h4>';
                        html += '<ul style="margin-left: 1.5rem; color: #e0e0e0; text-align: left;">';
                        api.strengths.forEach(function(s) {
                            html += '<li style="margin-bottom: 0.3rem;">' + s + '</li>';
                        });
                        html += '</ul></div>';
                    }

                    if (api.limitations) {
                        html += '<div style="background: linear-gradient(135deg, rgba(255,165,0,0.05), rgba(200,130,0,0.05)); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,165,0,0.1);">';
                        html += '<h4 style="color: #ffa500; margin-bottom: 0.5rem;">‚ö†Ô∏è Limitations</h4>';
                        html += '<p style="margin-left: 1rem; color: #e0e0e0;">' + api.limitations + '</p>';
                        html += '</div>';
                    }

                    if (api.specialization) {
                        html += '<div style="background: linear-gradient(135deg, rgba(138,43,226,0.05), rgba(128,0,128,0.05)); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(138,43,226,0.1);">';
                        html += '<h4 style="color: #ba55d3; margin-bottom: 0.5rem;">üéØ Specialization</h4>';
                        html += '<p style="margin-left: 1rem; color: #e0e0e0;">' + api.specialization + '</p>';
                        html += '</div>';
                    }

                    if (api.keyCount) {
                        html += '<div style="background: linear-gradient(135deg, rgba(0,191,255,0.05), rgba(0,136,204,0.05)); padding: 1rem; border-radius: 8px; border: 1px solid rgba(0,191,255,0.1);">';
                        html += '<h4 style="color: #00bfff; margin-bottom: 0.5rem;">üîë API Key Coverage</h4>';
                        html += '<p style="margin-left: 1rem; color: #e0e0e0;">' + api.keyCount + '</p>';
                        html += '</div>';
                    }

                    body.innerHTML = html;
                    modal.classList.add('show');
                }

                // Setup modal close handlers
                function setupModalHandlers() {
                    const closeBtn = document.getElementById('closeApiScoreModal');
                    const modal = document.getElementById('apiScoreModal');
                    
                    if (closeBtn) {
                        closeBtn.addEventListener('click', function() {
                            if (modal) modal.classList.remove('show');
                        });
                    }
                    
                    if (modal) {
                        modal.addEventListener('click', function(e) {
                            if (e.target === modal) {
                                modal.classList.remove('show');
                            }
                        });
                    }
                }

                // Run immediately when script loads
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', function() {
                        renderBars();
                        setupModalHandlers();
                    });
                } else {
                    renderBars();
                    setupModalHandlers();
                }
            })();
            </script>

            <!-- Input Section -->
            <section class="input-section">
                <div class="section-header">
                    <h2><i class="fas fa-search"></i> IOC Analysis</h2>
                    <p>Enter Indicators of Compromise (IOCs) for threat intelligence analysis</p>
                </div>

                <div class="input-grid">
                    <!-- Category 1: Fundamental Network Indicators -->
                    <div class="input-group">
                        <h3><i class="fas fa-network-wired"></i> Network Indicators</h3>
                        
                        <div class="form-group">
                            <label for="ipAddress">IP Address (IPv4/IPv6)</label>
                            <input type="text" id="ipAddress" placeholder="e.g., 8.8.8.8 or 2001:4860:4860::8888">
                            <div class="input-help">Enter IPv4 or IPv6 addresses</div>
                        </div>

                        <div class="form-group">
                            <label for="domain">Domain Name</label>
                            <input type="text" id="domain" placeholder="e.g., google.com">
                            <div class="input-help">Enter domain names without protocol</div>
                        </div>

                        <div class="form-group">
                            <label for="url">URL</label>
                            <input type="text" id="url" placeholder="e.g., https://example.com/path">
                            <div class="input-help">Enter full URLs with protocol</div>
                        </div>

                        <div class="form-group">
                            <label for="cidr">CIDR Block</label>
                            <input type="text" id="cidr" placeholder="e.g., 198.51.100.0/24">
                            <div class="input-help">Enter IP range in CIDR notation</div>
                        </div>

                        <div class="form-group">
                            <label for="hostname">Hostname</label>
                            <input type="text" id="hostname" placeholder="e.g., mail.google.com">
                            <div class="input-help">Enter specific hostnames</div>
                        </div>
                    </div>

                    <!-- Category 2: File-Based Indicators -->
                    <div class="input-group">
                        <h3><i class="fas fa-file-alt"></i> File Indicators</h3>
                        
                        <div class="form-group">
                            <label for="hashType">Hash Type</label>
                            <select id="hashType">
                                <option value="md5">MD5</option>
                                <option value="sha1">SHA-1</option>
                                <option value="sha256" selected>SHA-256</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="fileHash">File Hash</label>
                            <input type="text" id="fileHash" placeholder="Enter file hash">
                            <div class="input-help">Enter hash value based on selected type</div>
                        </div>

                        <div class="form-group">
                            <label for="fileName">File Name (Optional)</label>
                            <input type="text" id="fileName" placeholder="e.g., malware.exe">
                            <div class="input-help">Associated filename if known</div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Options -->
                <div class="enhanced-options">
                    <h3><i class="fas fa-cogs"></i> Analysis Options</h3>
                    <div class="options-grid">
                        <div class="option-item">
                            <label class="checkbox-label" for="includeRelations">
                                <input type="checkbox" id="includeRelations" checked>
                                <span class="checkmark"></span>
                                Include Relational Intelligence
                            </label>
                            <div class="option-help">Fetch related domains, IPs, and files for deeper analysis</div>
                        </div>
                        <div class="option-item">
                            <label class="checkbox-label" for="enableDeepAnalysis">
                                <input type="checkbox" id="enableDeepAnalysis">
                                <span class="checkmark"></span>
                                <strong>Enable Deep Analysis</strong> üî¨
                            </label>
                            <div class="option-help" style="color: #e74c3c; font-weight: 500;">
                                <i class="fas fa-info-circle"></i> Comprehensive network intelligence: DNS, WHOIS, geolocation, ASN, open ports, SSL certs, neighbors, and more. Results available as downloadable reports.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Input -->
                <div class="bulk-input-section">
                    <h3><i class="fas fa-list"></i> Bulk Analysis</h3>
                    <div class="form-group">
                        <label for="bulkInput">Bulk IOC Input</label>
                        <textarea id="bulkInput" rows="5" placeholder="Enter multiple IOCs, one per line&#10;8.8.8.8&#10;google.com&#10;https://example.com&#10;d41d8cd98f00b204e9800998ecf8427e"></textarea>
                        <div class="input-help">Enter multiple IOCs separated by new lines. Auto-detection will classify each type.</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="analyzeBtn">
                        <i class="fas fa-search"></i>
                        Analyze IOCs
                    </button>
                    <button class="btn btn-secondary" id="clearBtn">
                        <i class="fas fa-eraser"></i>
                        Clear All
                    </button>
                    <button class="btn btn-info" id="validateBtn">
                        <i class="fas fa-check-circle"></i>
                        Validate Format
                    </button>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-chart-line"></i> Analysis Results</h2>
                    <div class="results-summary" id="resultsSummary"></div>
                </div>

                <div class="results-grid" id="resultsGrid">
                    <!-- Enhanced results will be populated here -->
                </div>

                <div class="export-options">
                    <button class="btn btn-export" id="exportJson">
                        <i class="fas fa-download"></i>
                        Export JSON
                    </button>
                    <button class="btn btn-export" id="exportCsv">
                        <i class="fas fa-file-csv"></i>
                        Export CSV
                    </button>
                </div>
                
                <!-- Deep Analysis Download Options -->
                <div class="deep-export-options" id="deepExportOptions" style="display: none;">
                    <h3 style="margin-top: 20px;"><i class="fas fa-file-download"></i> Download Deep Analysis Reports</h3>
                    <div class="export-options">
                        <button class="btn btn-download" id="downloadJson">
                            <i class="fas fa-file-code"></i>
                            Download JSON Report
                        </button>
                        <button class="btn btn-download" id="downloadCsv">
                            <i class="fas fa-file-csv"></i>
                            Download CSV Report
                        </button>
                        <button class="btn btn-download" id="downloadPdf">
                            <i class="fas fa-file-pdf"></i>
                            Download PDF Report
                        </button>
                    </div>
                </div>
            </section>

            <!-- API Configuration -->
            <section class="config-section">
                <div class="section-header">
                    <h3><i class="fas fa-cog"></i> API Configuration</h3>
                    <button class="btn btn-small" id="toggleConfig">
                        <i class="fas fa-chevron-down"></i>
                        Configure
                    </button>
                </div>
                
                <div class="config-content" id="configContent" style="display: none;">
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="vtApiKey">VirusTotal API Key</label>
                            <input type="password" id="vtApiKey" placeholder="Enter API key">
                        </div>
                        <div class="config-item">
                            <label for="abuseApiKey">AbuseIPDB API Key</label>
                            <input type="password" id="abuseApiKey" placeholder="Enter API key">
                        </div>
                        <div class="config-item">
                            <label for="otxApiKey">AlienVault OTX API Key</label>
                            <input type="password" id="otxApiKey" placeholder="Enter API key">
                        </div>
                    </div>
                    <div class="config-actions">
                        <button class="btn btn-primary" id="saveConfig">
                            <i class="fas fa-save"></i>
                            Save Configuration
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Loading Modal -->
    <div class="modal" id="loadingModal">
        <div class="modal-content">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
            <h3 id="modalTitle">Analyzing IOCs...</h3>
            <p id="modalMessage">Please wait while we check your indicators against threat intelligence databases.</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
    </div>

    <!-- API Score Details Modal -->
    <div class="modal" id="apiScoreModal">
        <div class="modal-content" style="max-width: 700px; text-align: left;">
            <h3 id="apiScoreTitle">API Score</h3>
            <div id="apiScoreBody"></div>
            <div style="margin-top: 16px; text-align: right;">
                <button class="btn btn-secondary" id="closeApiScoreModal">Close</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 ThreatIntel Analyzer - Network & Data Communications Security Tool</p>
            <div class="footer-links">
                <span>Supported APIs: VirusTotal, AbuseIPDB, AlienVault OTX</span>
            </div>
        </div>
    </footer>

    <script src="static/js/script.js"></script>
</body>
</html>
